<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css"> 
    
    <title>Atlas Battery Price Comparison: Cheapest Cost Per Unit & Historical Lows</title>
    <meta name="description" content="We track prices to find the absolute lowest cost per unit for popular AA, AAA, and specialty batteries and compare current deals against historical lowest prices.">

    <style>
        /* Your custom styles to override Pico and handle highlights */
        body { 
            font-family: Arial, sans-serif; 
            line-height: 1.6; 
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
        }
        h2 { border-bottom: 2px solid var(--pico-secondary); padding-bottom: 5px; margin-top: 40px; }
        
        /* Custom Table Highlights (BOLD text only) */
        .best-deal { 
            font-weight: bold; 
            color: var(--pico-primary) !important; /* Use primary color for emphasis */
        }
        
        /* --- Tooltip CSS for Last Updated --- */
        tr {
            position: relative; /* Needed to position the tooltip */
            cursor: pointer;
        }
        tr::after {
            /* Grabs the hidden data from the data-updated attribute */
            content: attr(data-updated); 
            
            /* Styling and positioning for the tooltip box */
            position: absolute;
            top: -30px; /* Positions it above the row */
            right: 10px;
            padding: 5px 10px;
            background-color: var(--pico-secondary-background); /* Use Pico secondary background */
            color: var(--pico-color);
            border: 1px solid var(--pico-secondary);
            border-radius: 4px;
            z-index: 10;
            white-space: nowrap; /* Prevents text wrap */
            
            /* Initially hidden */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
        }

        /* Show the tooltip on hover (PC) */
        tr:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        /* Footer and Disclosure */
        footer { 
            margin-top: 50px; 
            padding-top: 20px;
            border-top: 1px solid #ccc;
            text-align: center;
        }
        .disclosure {
            font-size: 0.75em;
            color: #777;
            margin-top: 5px;
        }
        .seo-content { 
            margin-top: 30px; 
            padding: 15px; 
            background-color: var(--pico-section-background); 
            border-left: 5px solid var(--pico-primary); 
        }
    </style>
    
    <script src="papaparse.min.js"></script> 
</head>
<body>
    <main class="container"> 
        <h1>Battery Price Comparison (Unit Cost & Historical Value)</h1>
        <p>We track prices to find the absolute lowest <strong>Cost Per Unit</strong> for your batteries, comparing them against the best historical value. **(Hover over any row for the last updated date)**</p>

        <div id="loading">Loading comparison data from offers.csv...</div>
        
        <div id="comparison-container">
            </div>

        <div class="seo-content">
            <h2>Find the Cheapest Cost Per Unit for AA, AAA, and Specialty Batteries</h2>
            <p>Welcome to Atlas Battery Comparison! We are your dedicated resource for finding the true best value, calculated by the <strong>cost per unit</strong>. We now track current prices against the **Best Historical Price** to tell you if the deal is truly worth it. Why pay for expensive packaging when you can compare prices and identify the absolute cheapest deal on the market? We track popular brands like Energizer and Duracell, especially for **AA battery bulk pack** offers, to ensure you stop overpaying and always get the best price for your electronics.</p>
        </div>
    </main>

    <footer>
        <p class="disclosure">
            As an Amazon Associate I earn from qualifying purchases. | 
            <a href="privacy.html">Privacy Policy</a>
        </p>
    </footer>

    <script>
        const CSV_URL = 'offers.csv'; 

        window.onload = function() {
            Papa.parse(CSV_URL, {
                download: true,
                header: true,
                dynamicTyping: true,
                complete: showComparisonTables,
                error: function(error) {
                    document.getElementById('loading').textContent = 'ERROR loading CSV: Check file name and data format.';
                    console.error('Papa Parse Error:', error);
                }
            });
        }

        function showComparisonTables(results) {
            document.getElementById('loading').remove(); 
            
            const rawData = results.data.filter(row => row.Unit_Price); 
            const container = document.getElementById('comparison-container');
            
            // 1. Group Data by Product_Name_Short
            const groupedData = rawData.reduce((acc, item) => {
                const type = item.Product_Name_Short || 'Other Batteries';
                if (!acc[type]) {
                    acc[type] = [];
                }
                acc[type].push(item);
                return acc;
            }, {});

            // 2. Loop Through Groups and Build a Table for Each
            for (const batteryType in groupedData) {
                const typeOffers = groupedData[batteryType];
                
                // --- Group Logic ---
                let bestUnitPrice = Infinity;
                typeOffers.forEach(item => {
                    const unitPrice = parseFloat(item.Unit_Price);
                    if (!isNaN(unitPrice) && unitPrice > 0 && unitPrice < bestUnitPrice) {
                        bestUnitPrice = unitPrice;
                    }
                });
                typeOffers.sort((a, b) => parseFloat(a.Unit_Price) - parseFloat(b.Unit_Price));

                // 3. Create Heading and Table Element
                const heading = document.createElement('h2');
                heading.textContent = `${batteryType} Price Comparison`;
                container.appendChild(heading);

                const table = document.createElement('table');
                
                // UPDATED HEADERS: Removed Last Updated column
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Brand & Pack</th>
                            <th>Store</th>
                            <th>Unit Price (Current)</th>
                            <th>Best Hist. Unit Price</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                `;
                container.appendChild(table);
                const tableBody = table.querySelector('tbody');

                // 4. Populate Table Body
                typeOffers.forEach(item => {
                    const unitPrice = parseFloat(item.Unit_Price);
                    const historicalUnitLow = parseFloat(item.Best_Historical_Unit_Price); 
                    const isBestDeal = unitPrice === bestUnitPrice;
                    
                    const row = document.createElement('tr');
                    
                    // ADDED DATA ATTRIBUTE FOR TOOLTIP
                    row.setAttribute('data-updated', `Last Updated: ${item.Last_Updated}`);
                    
                    // Note: Removed the isBestDeal class from the row itself
                    
                    // UPDATED DATA CELLS: Removed Last Updated column, added bold styling to price
                    row.innerHTML = `
                        <td>${item.Brand} - ${item.Pack_Quantity} Pack</td>
                        <td>${item.Store_Name}</td>
                        <td><a href="${item.Store_Link}" target="_blank">
                            <span class="${isBestDeal ? 'best-deal' : ''}">\$${unitPrice.toFixed(2)}</span>
                        </a></td>
                        <td>\$${historicalUnitLow ? historicalUnitLow.toFixed(2) : 'N/A'}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }
    </script>
</body>
</html>
